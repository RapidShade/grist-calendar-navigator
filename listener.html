<!DOCTYPE html>
<html>
<head>
  <script>
    // File: navigator-listener.js
    // Description: Tiny Grist plugin widget that reads the grist-navigate hash and moves to the correct record
    
      function waitForHashAndNavigate() {
        const hash = window.location.hash;
        console.log("RapidShade: Current hash is", hash);
        if (!hash || !hash.startsWith("#grist-navigate:")) {
          requestAnimationFrame(waitForHashAndNavigate);
          return;
        }

        const match = hash.match(/^#grist-navigate:([^:]+):(\d+)/);
        if (!match) {
          console.log("RapidShade: Hash format invalid");
          return;
        }

        const [, table, rowIdStr] = match;
        const rowId = parseInt(rowIdStr, 10);
        if (!window.grist || !grist.setCursor) {
          console.log("RapidShade: grist.setCursor not available yet");
          requestAnimationFrame(waitForHashAndNavigate);
          return;
        }

        console.log(`RapidShade: Navigating to ${table}, row ${rowId}`);
        grist.setCursor(table, rowId);
      }

      window.addEventListener("DOMContentLoaded", () => {
        console.log("RapidShade: Navigator Listener Loaded");
        requestAnimationFrame(waitForHashAndNavigate);
      });
  </script>
</head>
<body>
  <p>Navigation listener loaded.</p>
</body>
</html>
