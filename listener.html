<!DOCTYPE html>
<html>
<head>
<script>
  console.log("RapidShade: Navigator Listener v 0.4");
  window.addEventListener("load", async () => {
    console.log("RapidShade: Navigator Listener Loaded");

    // Wait until `grist` is available
    while (!window.grist || !grist.setCursor) {
      await new Promise(resolve => setTimeout(resolve, 100));
    }

    const hash = window.location.hash;
    console.log("RapidShade: Current hash is", hash);

    const match = hash.match(/^#grist-navigate:([A-Za-z0-9_]+):([0-9]+)$/);
    if (match) {
      const [_, table, rowIdStr] = match;
      const rowId = parseInt(rowIdStr, 10);
      console.log(`RapidShade: Navigating to ${table}, row ${rowId}`);

      try {
        await grist.setCursor(table, rowId);
        console.log("RapidShade: Cursor set successfully");
      } catch (err) {
        console.error("RapidShade: Error setting cursor", err);
      }
    } else {
      console.log("RapidShade: No valid hash format for navigation");
    }
  });
</script>
</head>
<body>
  <p>Navigation listener loaded.</p>
</body>
</html>
