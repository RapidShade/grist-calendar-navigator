<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Grist Navigator Listener</title>
</head>
<body>
<script>
  console.log("🔁 Loading Grist Navigator Listener v2.31");

  // Request gristDocAPI
  function requestGristAPI() {
    console.log("📡 Requesting gristDocAPI via postMessage...");
    parent.postMessage({ type: "grist", message: "requestAPI" }, "*");
  }

  function waitForGristAPI(callback) {
    window.addEventListener("message", (event) => {
      const data = event.data;
      if (data && data.type === "grist" && data.api) {
        console.log("✅ Received gristDocAPI via postMessage");
        callback(data.api);
      }
    });

    // Repeatedly send request in case first is dropped
    let tries = 0;
    const interval = setInterval(() => {
      if (tries++ > 20) return clearInterval(interval);
      requestGristAPI();
    }, 500);
  }

  waitForGristAPI((api) => {
    // Now you can use api.setCursor(), etc.
    console.log("📌 Ready to navigate using received API");

    // Example:
    api.setCursor('EVENTS', 9);
  });
</script>
</body>
</html>
