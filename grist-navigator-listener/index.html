
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Grist Navigator Listener</title>
  <script type="module">
    console.clear();
    console.log("🔁 Loading Grist Navigator Listener v2.21");

    window.addEventListener("message", (event) => {
      console.log("📩 Received message:", event.data);
    });

    function waitForGristAPI() {
      return new Promise((resolve) => {
        const check = () => {
          if (window.grist) {
            console.log("✅ gristDocAPI is available");
            resolve(window.grist);
          } else {
            console.log("⏳ Waiting for gristDocAPI...");
            requestAnimationFrame(check);
          }
        };
        check();
      });
    }

    async function initialize() {
      const grist = await waitForGristAPI();
      grist.onRecord(() => {
        console.log("📌 Record changed in master view");
      });

      grist.ready();
    }

    initialize().catch(console.error);
  </script>
</head>
<body>
  <h2>Grist Navigator Listener v2.21</h2>
  <p>Listening for parent events and watching record changes...</p>
</body>
</html>
